
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Fitting wells &#8212; gwrefpy</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=938c9ccc"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'user_guide/2_fitting_wells';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Time offsets" href="3_time_offsets.html" />
    <link rel="prev" title="Intro to gwrefpy" href="1_intro_gwrefpy.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="gwrefpy - Home"/>
    <img src="../_static/logo.png" class="logo__image only-dark pst-js-only" alt="gwrefpy - Home"/>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item current active">
  <a class="nav-link nav-internal" href="index.html">
    User guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../tutorials/index.html">
    Tutorials
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../apidocs.html">
    API Reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../about/index.html">
    About
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/andersretznerSGU/gwrefpy" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><img src="https://upload.wikimedia.org/wikipedia/commons/9/91/Octicons-mark-github.svg" class="icon-link-image" alt="GitHub"/></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item current active">
  <a class="nav-link nav-internal" href="index.html">
    User guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../tutorials/index.html">
    Tutorials
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../apidocs.html">
    API Reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../about/index.html">
    About
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/andersretznerSGU/gwrefpy" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><img src="https://upload.wikimedia.org/wikipedia/commons/9/91/Octicons-mark-github.svg" class="icon-link-image" alt="GitHub"/></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="1_intro_gwrefpy.html">Intro to <code class="docutils literal notranslate"><span class="pre">gwrefpy</span></code></a></li>





<li class="toctree-l1 current active"><a class="current reference internal" href="#">Fitting wells</a></li>
<li class="toctree-l1"><a class="reference internal" href="3_time_offsets.html">Time offsets</a></li>


<li class="toctree-l1"><a class="reference internal" href="4_plotting.html">Plotting with gwrefpy ðŸ“Š</a></li>
<li class="toctree-l1"><a class="reference internal" href="5_io.html">Saving and loading models</a></li>

<li class="toctree-l1"><a class="reference internal" href="6_logging.html">Logging ðŸ“„</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">User guide</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Fitting wells</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="fitting-wells">
<h1>Fitting wells<a class="headerlink" href="#fitting-wells" title="Link to this heading">#</a></h1>
<p>This notebook introduces the concept of fitting wells and how they are used in <code class="docutils literal notranslate"><span class="pre">gwrefpy</span></code>. The methodology originates from the description by its author <a class="reference external" href="https://svenskageotekniskaforeningen.se/wp-content/uploads/Publikationer/SGF_Rapporter/2024_2_Akvifars_refmetod.pdf">Strandanger (2024)</a>.</p>
<p>This notebook can be downloaded from the source code <a class="reference external" href="https://github.com/andersretznerSGU/gwrefpy/blob/main/docs/user_guide/2_fitting_wells.ipynb">here</a>.</p>
<p>To analyse deviations in groundwater level timeseries, the <code class="docutils literal notranslate"><span class="pre">gwrefpy</span></code> methodology relies on observation wells and reference wells. To check for deviations in an observation well, we fit its data to a reference well using regression. When fitting the two wells, we specify a calibration period. If data outside of the calibration period does not follow the fitted regression, a deviation has occurred.</p>
<p>In this notebook, we will dive deeper into the fitting workflow and showcase this libraryâ€™s associated capabilities.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>See <a class="reference external" href="https://github.com/andersretznerSGU/gwrefpy/blob/main/docs/user_guide/1_intro_gwrefpy.ipynb">this notebook on wells</a></p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">gwrefpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">gr</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
<span class="n">gr</span><span class="o">.</span><span class="n">set_log_level</span><span class="p">(</span><span class="s2">&quot;ERROR&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">set_loglevel</span><span class="p">(</span><span class="s2">&quot;ERROR&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="data">
<h2>Data<a class="headerlink" href="#data" title="Link to this heading">#</a></h2>
<p>In this notebook, we will work with data provided by <code class="docutils literal notranslate"><span class="pre">gwrefpy</span></code>. Letâ€™s load the model using its file name and plot the observation well and reference well separately.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="s2">&quot;deviation_example.gwref&quot;</span><span class="p">)</span>
<span class="n">model</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Model(name=&#39;deviation example&#39;, wells=2, fits=0)
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">up</span><span class="p">,</span> <span class="n">down</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">plot_wells</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">obs_wells</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">up</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">plot_wells</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">ref_wells</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">down</span><span class="p">)</span>

<span class="n">up</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;obs wells&quot;</span><span class="p">)</span>
<span class="n">down</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;ref wells&quot;</span><span class="p">)</span>

<span class="n">up</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">down</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">fig</span><span class="o">.</span><span class="n">autofmt_xdate</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/86a10b014b9d4560c014f16cd693f3943d1138537748b4ef27a99311b66b43e8.png" src="../_images/86a10b014b9d4560c014f16cd693f3943d1138537748b4ef27a99311b66b43e8.png" />
</div>
</div>
</section>
<section id="anatomy-of-a-fit">
<h2>Anatomy of a fit<a class="headerlink" href="#anatomy-of-a-fit" title="Link to this heading">#</a></h2>
<p>Letâ€™s walk through the anatomy of a fit by fitting the observation well <em>12GIPGW</em> to the reference well <em>45LOGW</em>. To fit wells within a model, we call <code class="docutils literal notranslate"><span class="pre">model.fit()</span></code> which has the following signature:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">help</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Help on method fit in module gwrefpy.fitbase:

fit(obs_well: gwrefpy.well.Well | list[gwrefpy.well.Well] | str | list[str], ref_well: gwrefpy.well.Well | list[gwrefpy.well.Well] | str | list[str], offset: pandas._libs.tslibs.offsets.DateOffset | pandas._libs.tslibs.timedeltas.Timedelta | str, aggregation: Literal[&#39;mean&#39;, &#39;median&#39;, &#39;min&#39;, &#39;max&#39;] = &#39;mean&#39;, p: float = 0.95, method: Literal[&#39;linearregression&#39;] = &#39;linearregression&#39;, tmin: pandas._libs.tslibs.timestamps.Timestamp | str | None = None, tmax: pandas._libs.tslibs.timestamps.Timestamp | str | None = None, report: bool = True) -&gt; gwrefpy.fitresults.FitResultData | list[gwrefpy.fitresults.FitResultData] method of gwrefpy.model.Model instance
    Fit reference well(s) to observation well(s) using regression.
    
    Parameters
    ----------
    obs_well : Well | list[Well] | str | list[str]
        The observation well(s) to use for fitting. Can be Well objects,
        well names (strings), or lists of either. If a list is provided,
        each well will be paired with the corresponding reference well by index.
    ref_well : Well | list[Well] | str | list[str]
        The reference well(s) to use for fitting. Can be Well objects,
        well names (strings), or lists of either. If a list is provided,
        each well will be paired with the corresponding observation well by index.
    offset: pd.DateOffset | pd.Timedelta | str
        The offset to apply to the time series when grouping within time
        equivalents.
    aggregation: Literal[&quot;mean&quot;, &quot;median&quot;, &quot;min&quot;, &quot;max&quot;], optional
        The aggregation method to use when grouping data points within time
        equivalents (default is &quot;mean&quot;).
    p : float, optional
        The confidence level for the fit (default is 0.95).
    method : Literal[&quot;linearregression&quot;]
        Method with which to perform regression. Currently only supports
        linear regression.
    tmin: pd.Timestamp | str | None = None
        Minimum time for calibration period.
    tmax: pd.Timestamp | str | None = None
        Maximum time for calibration period.
    report: bool, optional
        Whether to print fit results summary (default is True).
    
    Returns
    -------
    FitResultData | list[FitResultData]
        If single wells are provided, returns a single FitResultData object.
        If lists of wells are provided, returns a list of FitResultData objects
        for each obs_well/ref_well pair.
    
    Raises
    ------
    ValueError
        If lists are provided but have different lengths.
</pre></div>
</div>
</div>
</div>
<p>The first two arguments determine which wells to use.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">offset</span></code> and <code class="docutils literal notranslate"><span class="pre">aggregation</span></code> arguments handle cases where the timeseries of the wells are not aligned, see <a class="reference internal" href="#"><span class="xref myst">this notebook</span></a>. The wells in this model are sampled daily and cover the same period, which means we can use <code class="docutils literal notranslate"><span class="pre">&quot;0D&quot;</span></code> as the offset which also renders the <code class="docutils literal notranslate"><span class="pre">aggregation</span></code> argument obsolete.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">p</span></code> argument controls which confidence level to use when evaluating the lower and upper bound from which to recognize deviations. We will use the default <code class="docutils literal notranslate"><span class="pre">p</span></code>-value of 0.05.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">tmin</span></code> and <code class="docutils literal notranslate"><span class="pre">tmax</span></code> arguments control the period in which we want to perform the fit. This is an important decision that can only be inferred from prior knowledge of the wells. We want to select this period such that no (or negligble) external factors are affecting head in the observation well. In this example, we will assume that data until 2022 is unaffected and can be used for fitting a regression.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The reference well needs to be unaffected by external factors during its entire time period.</p>
</div>
<p>Currently, <code class="docutils literal notranslate"><span class="pre">gwrefpy</span></code> supports the linear regression fit as demonstrated in <a class="reference external" href="https://svenskageotekniskaforeningen.se/wp-content/uploads/Publikationer/SGF_Rapporter/2024_2_Akvifars_refmetod.pdf">Strandanger (2024)</a>, which is what we will cover in this notebook. Linear regression is currently the only available method, which is why we donâ€™t have to explicitly pass it.</p>
<p>Letâ€™s do this!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
    <span class="n">obs_well</span><span class="o">=</span><span class="s2">&quot;19W110U&quot;</span><span class="p">,</span>
    <span class="n">ref_well</span><span class="o">=</span><span class="s2">&quot;19W100U&quot;</span><span class="p">,</span>
    <span class="n">offset</span><span class="o">=</span><span class="s2">&quot;0D&quot;</span><span class="p">,</span>
    <span class="n">tmax</span><span class="o">=</span><span class="s2">&quot;2022&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
        <div>
            <strong>Fit Results: 19W110U ~ 19W100U</strong>
            <table>
                <thead>
                    <tr>
                        <th style="text-align: left">Statistic</th>
                        <th style="text-align: left">Value</th>
                        <th style="text-align: left">Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>RMSE</td>
                        <td>0.1514</td>
                        <td>Root Mean Square Error</td>
                    </tr>
                    <tr>
                        <td>RÂ²</td>
                        <td>0.9699</td>
                        <td>Coefficient of Determination</td>
                    </tr>
                    <tr>
                        <td>R-value</td>
                        <td>0.9848</td>
                        <td>Correlation Coefficient</td>
                    </tr>
                    <tr>
                        <td>Slope</td>
                        <td>1.0058</td>
                        <td>Linear Regression Slope</td>
                    </tr>
                    <tr>
                        <td>Intercept</td>
                        <td>-0.1676</td>
                        <td>Linear Regression Intercept</td>
                    </tr>
                    <tr>
                        <td>P-value</td>
                        <td>0.0000</td>
                        <td>Statistical Significance</td>
                    </tr>
                    <tr>
                        <td>N</td>
                        <td>1826</td>
                        <td>Number of Data Points</td>
                    </tr>
                    <tr>
                        <td>Std Error</td>
                        <td>0.1515</td>
                        <td>Standard Error</td>
                    </tr>
                    <tr>
                        <td>Confidence</td>
                        <td>95.0%</td>
                        <td>Confidence Level</td>
                    </tr>
                </tbody>
            </table>
            <p>
                Calibration Period: 2018-01-01 00:00:00 to 2022<br>
                Time Offset: 0D<br>
                Aggregation Method: mean
            </p>
        </div>
        </div></div>
</div>
<p>By default when calling <code class="docutils literal notranslate"><span class="pre">fit()</span></code>, a summary of the fitted regression is displayed as seen above.</p>
<p>Calling <code class="docutils literal notranslate"><span class="pre">fit()</span></code> results in a <code class="docutils literal notranslate"><span class="pre">FitResultData</span></code> object being created and stored in the model instanceâ€™s <code class="docutils literal notranslate"><span class="pre">fits</span></code> attribute. Letâ€™s plot the resulting fit to verify everything is OK. We use the <code class="docutils literal notranslate"><span class="pre">plot_fitmethod()</span></code> method and pass all available fits knowing it will only contain the fit we just created.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">plot_fitmethod</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">fits</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/afb31c6efc7b6adbddae9b08c45fb0f402c00de41cdd746b1e10efccbac33584.png" src="../_images/afb31c6efc7b6adbddae9b08c45fb0f402c00de41cdd746b1e10efccbac33584.png" />
</div>
</div>
<p>We can see that for the training data, which is data used to fit the regression, our fit seems OK. Observed heads outside of this period show a different behavior - one might suspect a deviation!</p>
</section>
<section id="analysing-deviations">
<h2>Analysing deviations<a class="headerlink" href="#analysing-deviations" title="Link to this heading">#</a></h2>
<p>Evaluating deviation is a key <code class="docutils literal notranslate"><span class="pre">gwrefpy</span></code> feature! Below, we plot the resulting fit and transformed head, along with the lower and upper confidence limit based on our <code class="docutils literal notranslate"><span class="pre">p</span></code> value (0.05) and the fit.</p>
<p>Below, we retrieve the fit from the model and get the associated fitted timeseries for the reference well and the upper and lower bound associated with the <code class="docutils literal notranslate"><span class="pre">p</span></code> value.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Below, we generate the plot by hand to showcase how to retrieve the fitted timeseries and its associated upper and lower bound. If you want to quickly review a fit and deviations, use <code class="docutils literal notranslate"><span class="pre">model.plot_fits()</span></code>.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fit</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">get_fits</span><span class="p">(</span><span class="s2">&quot;19W100U&quot;</span><span class="p">)</span>  <span class="c1"># we know we only have one fit, so this will be a single object</span>
<span class="n">fitted_ref</span> <span class="o">=</span> <span class="n">fit</span><span class="o">.</span><span class="n">get_fit_timeseries</span><span class="p">()</span>
<span class="n">upper_bound</span> <span class="o">=</span> <span class="n">fit</span><span class="o">.</span><span class="n">get_upper_confidence_bound</span><span class="p">()</span>
<span class="n">lower_bound</span> <span class="o">=</span> <span class="n">fit</span><span class="o">.</span><span class="n">get_lower_confidence_bound</span><span class="p">()</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">fitted_ref</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">y1</span><span class="o">=</span><span class="n">lower_bound</span><span class="p">,</span> <span class="n">y2</span><span class="o">=</span><span class="n">upper_bound</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">&quot;2022&quot;</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Calibration stop&quot;</span><span class="p">)</span>


<span class="n">_</span> <span class="o">=</span> <span class="n">fitted_ref</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;19W100U (fitted)&quot;</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">obs</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">get_wells</span><span class="p">(</span><span class="s2">&quot;19W110U&quot;</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;19W110U&quot;</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/9addf8b754f3045c171e9ee5a980ec8dc1b23fee2fd820634d26c5e2500333ec.png" src="../_images/9addf8b754f3045c171e9ee5a980ec8dc1b23fee2fd820634d26c5e2500333ec.png" />
</div>
</div>
<p>Seems like the observation well (19W110U) dips below the lower bound during 2023 and 2024. Letâ€™s zoom into this period and plot the timesteps where this occurs with a different color after retrivieing them with the <code class="docutils literal notranslate"><span class="pre">get_outliers()</span></code> method.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">fitted_ref</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">y1</span><span class="o">=</span><span class="n">lower_bound</span><span class="p">,</span> <span class="n">y2</span><span class="o">=</span><span class="n">upper_bound</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">fitted_ref</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;2022&quot;</span><span class="p">:]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;19W100U (fitted)&quot;</span><span class="p">)</span>
<span class="n">obs</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;2022&quot;</span><span class="p">:]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;19W110U&quot;</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/b84b36a7b8ef066b2f575365a50f71793a59d56453cef5a182c0f984746129c4.png" src="../_images/b84b36a7b8ef066b2f575365a50f71793a59d56453cef5a182c0f984746129c4.png" />
</div>
</div>
</section>
<section id="generate-multiple-fits-at-once">
<h2>Generate multiple fits at once<a class="headerlink" href="#generate-multiple-fits-at-once" title="Link to this heading">#</a></h2>
<p>With <code class="docutils literal notranslate"><span class="pre">gwrefpy</span></code>, you can fit as many reference wells as you like to a single observation well. This is useful if you have many wells to choose from, and would like to rank their fit performance.</p>
<p>Below, we load an example model with many observation and reference wells and clear its existing fits.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">large_model</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="s2">&quot;large_example.gwref&quot;</span><span class="p">)</span>
<span class="n">large_model</span><span class="o">.</span><span class="n">fits</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">large_model</span><span class="o">.</span><span class="n">obs_wells</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[Well(name=01OBS), Well(name=02OBS), Well(name=03OBS)]
</pre></div>
</div>
</div>
</div>
<p>We choose a observation well and then run <code class="docutils literal notranslate"><span class="pre">best_fit()</span></code>, which will default to perform a fit for all available reference wells.</p>
<p>This project many reference wells, so we select only the top 3 fits with <code class="docutils literal notranslate"><span class="pre">remove_fits_by_n()</span></code> and then plot the resulting regression fit by fit.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_</span> <span class="o">=</span> <span class="n">large_model</span><span class="o">.</span><span class="n">best_fit</span><span class="p">(</span><span class="n">obs_well</span><span class="o">=</span><span class="s2">&quot;01OBS&quot;</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="s2">&quot;0D&quot;</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">large_model</span><span class="o">.</span><span class="n">remove_fits_by_n</span><span class="p">(</span><span class="s2">&quot;01OBS&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">large_model</span><span class="o">.</span><span class="n">fits</span><span class="p">),</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">fit</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span> <span class="n">large_model</span><span class="o">.</span><span class="n">fits</span><span class="p">):</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">large_model</span><span class="o">.</span><span class="n">plot_fitmethod</span><span class="p">(</span><span class="n">fit</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">legend</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend</span><span class="p">()</span>
    <span class="n">legend</span><span class="o">.</span><span class="n">set_bbox_to_anchor</span><span class="p">((</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">))</span>
    <span class="n">legend</span><span class="o">.</span><span class="n">set_loc</span><span class="p">(</span><span class="s2">&quot;upper center&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/3f430dfd8123657a770ef9197df50e4068aa29ec288e5a9eb1f1eba67b8bc743.png" src="../_images/3f430dfd8123657a770ef9197df50e4068aa29ec288e5a9eb1f1eba67b8bc743.png" />
</div>
</div>
<p>This is a great way to evaluate many reference wells for a single observation well!</p>
<p>Happy fitting!</p>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="1_intro_gwrefpy.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Intro to <code class="docutils literal notranslate"><span class="pre">gwrefpy</span></code></p>
      </div>
    </a>
    <a class="right-next"
       href="3_time_offsets.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Time offsets</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data">Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#anatomy-of-a-fit">Anatomy of a fit</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analysing-deviations">Analysing deviations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#generate-multiple-fits-at-once">Generate multiple fits at once</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/user_guide/2_fitting_wells.ipynb.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>